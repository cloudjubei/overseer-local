@import './styles/design-tokens.css';

@tailwind base;
@tailwind components;
@tailwind utilities;

/* Root layout: make the app fill the window and avoid unexpected margins */
html, body, #root { height: 100%; }
html, body { margin: 0; padding: 0; }

/* Base body colors using semantic tokens */
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
  color: var(--text-primary);
  background: var(--surface-base);
}

h1, h2, h3 { color: var(--accent-primary); }

/* Buttons */
button, .btn {
  background: var(--accent-primary);
  color: var(--text-inverted);
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
}
button:hover, .btn:hover { background: var(--accent-primary-hover); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
button:active, .btn:active { background: var(--accent-primary-active); }

.btn-secondary { background: var(--surface-raised); color: var(--text-primary); border: 1px solid var(--border-default); }
.btn-secondary:hover { background: color-mix(in srgb, var(--surface-raised) 92%, var(--surface-base)); }

/* Tasks view */
#tasks-view { margin: 1rem 0 2rem 0; background: var(--surface-base); padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.08); }

.tasks-toolbar { display: flex; justify-content: space-between; gap: 0.75rem; align-items: center; margin-bottom: 0.5rem; }
.tasks-toolbar .left { display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap; }
.tasks-toolbar .left .control input[type="search"], .tasks-toolbar .left .control select { width: 220px; padding: 0.5rem 0.6rem; border: 1px solid var(--border-default); border-radius: 6px; font-size: 0.95rem; background: var(--surface-raised); color: var(--text-primary); }
.tasks-toolbar .right { display: flex; gap: 0.5rem; align-items: center; }
.view-toggle { display: inline-flex; background: var(--surface-raised); border: 1px solid var(--border-default); border-radius: 8px; overflow: hidden; }
.view-toggle .toggle { background: transparent; color: var(--text-primary); border: none; padding: 0.4rem 0.75rem; border-right: 1px solid var(--border-subtle); }
.view-toggle .toggle:last-child { border-right: 0; }
.view-toggle .toggle.active { background: color-mix(in srgb, var(--surface-raised) 90%, var(--surface-base)); font-weight: 600; }

.tasks-count { font-size: 0.9rem; color: var(--text-muted); margin: 0.25rem 0 0.75rem 0; }
.tasks-results .empty { padding: 1rem; background: var(--surface-raised); border: 1px dashed var(--border-subtle); border-radius: 6px; color: var(--text-secondary); }

.tasks-list { list-style: none; padding: 0; margin: 0; }
.task-item + .task-item { margin-top: 6px; }
.task-row { display: grid; grid-template-columns: 80px 1fr 240px 120px; gap: 0.5rem 1rem; align-items: center; padding: 0.6rem 0.75rem; border: 1px solid var(--border-default); border-radius: 8px; background: var(--surface-raised); outline: none; transition: all 0.2s ease; }
.task-row:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
.task-row:focus { box-shadow: 0 0 0 3px color-mix(in srgb, var(--focus-ring) 38%, transparent); border-color: var(--border-focus); }
.task-row.draggable { cursor: grab; }
.col-id { font-variant-numeric: tabular-nums; color: var(--text-primary); font-weight: 600; }
.col-title { overflow: hidden; }
.col-title .title-line { display: flex; align-items: center; gap: 0.5rem; }
.col-title .title-text { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-weight: 600; }
.col-title .desc-line { font-size: 12px; color: var(--text-muted); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.col-status .status-inline { display: inline-flex; align-items: center; gap: 0.5rem; }
.col-status .status-select { appearance: auto; padding: 0.25rem 0.4rem; border-radius: 6px; border: 1px solid var(--border-default); background: var(--surface-raised); color: var(--text-primary); }
.col-features { color: var(--text-primary); }

/* Legacy StatusBadge fallback classes map to tokenized soft variants */
.status-badge { display: inline-block; padding: 0.15rem 0.5rem; border-radius: 999px; font-size: 0.8rem; line-height: 1.2; border: 1px solid transparent; }
.status-done { background: var(--status-done-soft-bg); color: var(--status-done-soft-fg); border-color: var(--status-done-soft-border); }
.status-inprogress { background: var(--status-working-soft-bg); color: var(--status-working-soft-fg); border-color: var(--status-working-soft-border); }
.status-pending { background: var(--status-queued-soft-bg); color: var(--status-queued-soft-fg); border-color: var(--status-queued-soft-border); }
.status-blocked { background: color-mix(in srgb, var(--status-blocked-bg) 14%, transparent); color: #FFDEE0; border-color: color-mix(in srgb, var(--status-blocked-bg) 60%, transparent); }
.status-deferred { background: var(--status-on_hold-soft-bg); color: var(--status-on_hold-soft-fg); border-color: var(--status-on_hold-soft-border); }

/* Task Card (Board) */
.task-card { background: var(--surface-raised); border: 1px solid var(--border-default); border-radius: 10px; padding: 8px 10px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); transition: box-shadow .15s ease, transform .15s ease; }
.task-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.08); transform: translateY(-1px); }
.task-card__header { display: flex; align-items: center; gap: 6px; }
.task-card__id { font-variant-numeric: tabular-nums; font-size: 12px; color: var(--text-muted); }
.task-card__title { margin-top: 4px; font-size: 14px; font-weight: 600; color: var(--text-primary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.task-card__meta { margin-top: 6px; }

/* Priority tag */
.priority-tag { display: inline-flex; align-items: center; font-weight: 700; font-size: 10px; padding: 2px 6px; border-radius: 999px; border: 1px solid transparent; }
.priority--p0 { background: color-mix(in srgb, var(--color-red-600) 16%, transparent); color: var(--color-red-800); border-color: var(--color-red-400); }
.priority--p1 { background: color-mix(in srgb, var(--color-orange-650) 18%, transparent); color: var(--color-orange-800); border-color: var(--color-orange-400); }
.priority--p2 { background: color-mix(in srgb, var(--color-blue-650) 14%, transparent); color: var(--color-blue-800); border-color: var(--color-blue-400); }
.priority--p3 { background: color-mix(in srgb, var(--color-gray-400) 18%, transparent); color: var(--color-gray-700); border-color: var(--color-gray-400); }

/* Board layout */
.board { display: grid; grid-template-columns: repeat(5, minmax(220px, 1fr)); gap: 12px; align-items: start; }
.board-col { background: var(--surface-raised); border: 1px solid var(--border-default); border-radius: 12px; min-height: 80px; display: flex; flex-direction: column; max-height: 70vh; }
.board-col__header { display: flex; align-items: center; justify-content: space-between; padding: 8px 10px; border-bottom: 1px solid var(--border-subtle); font-weight: 600; }
.board-col__title { font-size: 13px; }
.board-col__count { font-size: 12px; color: var(--text-muted); }
.board-col__body { padding: 8px; display: flex; flex-direction: column; gap: 8px; overflow-y: auto; min-height: 60px; }

/* Colorful column header accents (Monday-like) */
.header-+ { background: color-mix(in srgb, var(--status-done-soft-bg) 50%, transparent); }
.header-~ { background: color-mix(in srgb, var(--status-working-soft-bg) 50%, transparent); }
.header-- { background: color-mix(in srgb, var(--status-queued-soft-bg) 50%, transparent); }
.header-\? { background: color-mix(in srgb, var(--status-stuck-soft-bg) 50%, transparent); }
.header-= { background: color-mix(in srgb, var(--status-on_hold-soft-bg) 50%, transparent); }

/* Features (Task Details) */
#task-details-view { margin: 1rem 0 2rem 0; background: var(--surface-base); padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.08); }
.features-list { list-style: none; padding: 0; margin: 0; }
.feature-item + .feature-item { margin-top: 8px; }
.feature-row { display: grid; grid-template-columns: 80px 1fr 160px 120px; gap: 0.5rem 1rem; align-items: start; padding: 0.6rem 0.75rem; border: 1px solid var(--border-default); border-radius: 8px; background: var(--surface-raised); transition: all 0.2s ease; }
.feature-row:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
.feature-row.editing { grid-template-columns: 80px 1fr; }
.col-actions { text-align: right; }
.feature-edit-form .form-row { display: grid; grid-template-columns: 140px 1fr; gap: 0.5rem; align-items: center; margin-bottom: 0.5rem; }
.feature-edit-form .form-actions { display: flex; gap: 0.5rem; align-items: center; }
.feature-edit-form label { color: var(--text-secondary); font-size: 0.9rem; }
.feature-edit-form input[type="text"], .feature-edit-form textarea, .feature-edit-form select { width: 100%; padding: 0.5rem 0.6rem; border: 1px solid var(--border-default); border-radius: 6px; font-size: 0.95rem; transition: all 0.2s ease; background: var(--surface-raised); color: var(--text-primary); }
.feature-edit-form input:focus, .feature-edit-form textarea:focus, .feature-edit-form select:focus { border-color: var(--border-focus); box-shadow: 0 0 0 3px color-mix(in srgb, var(--focus-ring) 30%, transparent); }
.btn-edit, .btn-save, .btn-cancel, .btn-back, .btn-add-row, .btn-remove-row { padding: 0.45rem 0.75rem; border-radius: 6px; cursor: pointer; transition: all 0.2s ease; }
.btn-edit, .btn-save { background: var(--accent-primary); color: var(--text-inverted); border: none; }
.btn-cancel, .btn-back, .btn-add-row, .btn-remove-row { background: var(--surface-raised); border: 1px solid var(--border-default); color: var(--text-primary); }
.btn-edit:hover, .btn-save:hover { background: var(--accent-primary-hover); }
.btn-cancel:hover, .btn-back:hover, .btn-add-row:hover, .btn-remove-row:hover { background: color-mix(in srgb, var(--surface-raised) 92%, var(--surface-base)); }
.task-meta { margin: 0.5rem 0 1rem; }
.task-meta .task-title { display: flex; gap: 0.5rem; align-items: center; }
.task-meta .task-desc { margin-top: 0.25rem; color: var(--text-secondary); }

/* String list editor */
.string-list { width: 100%; }
.string-list-rows { list-style: none; padding: 0; margin: 0 0 0.5rem 0; }
.string-list-row { display: flex; gap: 0.5rem; align-items: center; margin-bottom: 0.4rem; }
.string-list-row input[type="text"] { flex: 1 1 auto; }

/* Popup styles */
.container { padding: 2rem; max-width: 40rem; margin: auto; }
.form-group { margin-bottom: 1rem; }
.form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-secondary); }
.form-group input, .form-group textarea, .form-group select { width: 100%; padding: 0.5rem; border: 1px solid var(--border-default); border-radius: 6px; transition: all 0.2s ease; background: var(--surface-raised); color: var(--text-primary); }
.form-group input:focus, .form-group textarea:focus, .form-group select:focus { border-color: var(--border-focus); box-shadow: 0 0 0 3px color-mix(in srgb, var(--focus-ring) 30%, transparent); }
.form-actions { display: flex; justify-content: flex-end; gap: 1rem; }

/* Responsive tweaks */
@media (max-width: 980px) {
  .board { grid-template-columns: repeat(2, minmax(220px, 1fr)); }
}
@media (max-width: 720px) {
  .tasks-toolbar { flex-direction: column; align-items: stretch; }
  .tasks-toolbar .left .control input[type="search"], .tasks-toolbar .left .control select { width: 100%; }
  .task-row { grid-template-columns: 70px 1fr; }
  .col-status, .col-features { margin-left: 70px; }
  .board { grid-template-columns: 1fr; }
}
